
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /electionRooms/{roomId} {
      // Public can read election details for voting.
      // Admins can create, update, delete election rooms.
      allow read;
      allow write: if request.auth != null;

      // Rules for the 'voters' subcollection within an election room.
      match /voters/{userEmail} {
        // Anyone can check if a vote exists for a specific email.
        allow get: if true;
        
        // Anyone can create their own vote record once.
        allow create: if true;

        // Nobody can update a vote record. Votes are immutable.
        allow update: if false;

        // Admins can list or delete vote records for auditing or corrections.
        // Users cannot list all voters in an election.
        allow list, delete: if request.auth != null;
      }
    }
  }
}
