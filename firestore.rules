rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    match /electionRooms/{roomId} {
      // Anyone can read election room details for voting.
      allow read: if true;
      
      // Only authenticated admins can create, update, or delete rooms.
      allow write: if request.auth != null; 

      // Rules for the 'voters' subcollection
      match /voters/{voterId} {
        // Only authenticated admins can list the voters. This is for the admin dashboard.
        allow list: if request.auth != null; 
        
        // Admins can read individual voter records if needed (e.g., for verification).
        allow read: if request.auth != null; 
        
        // Any user can create their own vote record once, but cannot update or delete it.
        // This is how they cast a vote.
        allow create: if true;
        allow update, delete: if false;
      }
    }
  }
}
